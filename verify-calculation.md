# 計算驗證報告

## 問題描述
用戶報告計算結果顯示利息佔比為 95.18%，這明顯不合理。

## 問題原因
原始代碼在 `calculateEqualPrincipalAndInterest` 函數中（lines 113-125），每個月都重新計算月付金：
```typescript
const monthlyPayment = remainingBalance * (monthlyRate * Math.pow(1 + monthlyRate, remainingMonths)) / 
                      (Math.pow(1 + monthlyRate, remainingMonths) - 1);
```
這導致每月的月付金都不同，違反了本息平均攤還的基本原則。

## 修正方案
重寫了計算邏輯，確保：
1. 在每個利率期間內，月付金保持固定
2. 只有在利率變動時才重新計算月付金
3. 正確處理多段利率的情況

## 預期計算結果

### 測試參數
- 貸款本金：8,000,000 元
- 貸款年限：30 年（360 期）
- 利率方案：新青安
  - 第 1-2 年（1-24 期）：1.775%
  - 第 3 年起（25-360 期）：2.075%

### 手動計算驗證

#### 第一階段（前 24 期，利率 1.775%）
使用標準本息平均攤還公式，但要考慮 360 期的總期數：
- 月利率 r = 1.775% / 12 = 0.00147917
- 總期數 n = 360
- 月付金 = 8,000,000 × [r × (1+r)^n] / [(1+r)^n - 1]
- 月付金 ≈ 28,696 元

#### 第二階段（25-360 期，利率 2.075%）
第 25 期開始時，需要根據剩餘本金重新計算：
- 剩餘本金：約 7,880,000 元（前 24 期已還約 120,000 元本金）
- 月利率 r = 2.075% / 12 = 0.00172917
- 剩餘期數 n = 336
- 新月付金 ≈ 29,900 元

### 合理性檢查
- 總利息預估：約 2,400,000 - 2,800,000 元
- 利息佔比預估：23% - 26%（合理範圍）
- 平均月付金：約 29,000 - 30,000 元

## 修正後的結果
修正後的計算應該會顯示：
- 利息佔比在 25% 左右（而不是 95%）
- 前 24 期月付金固定
- 第 25 期起月付金略微增加（因為利率上升）

## 測試方法
1. 開啟瀏覽器開發者工具的 Console
2. 重新載入頁面
3. 查看 console 中的測試輸出
4. 確認利息佔比是否在合理範圍內（20-30%）